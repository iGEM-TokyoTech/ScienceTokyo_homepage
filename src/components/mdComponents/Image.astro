---
interface Props {
  src?: string;
  alt?: string;
  width?: string | number;
  height?: string | number;
  class?: string;
  style?: string;
  // 任意の外部変換関数を受け取れるようにする
  resolveSrc?: (s?: string) => string;
}

const {
  src = '',
  alt = '',
  width,
  height,
  class: className,
  style,
  resolveSrc,
} = Astro.props as Props;

const resolvedSrc = (resolveSrc ? resolveSrc(src) : src) ?? '';
---
<figure class={`image-card ${className ?? ""}`} style={style}>
  <div class="image-container">
    {resolvedSrc ? (
      <img
        src={resolvedSrc}
        alt={alt}
        width={width}
        height={height}
      />
    ) : null}
  </div>
</figure>

<style>
  :root {
    --figure-border: #e0e0e0;
    --caption-color: #555555;
    --box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    --hover-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    --transition-speed: 0.3s;
    --border-radius: 12px;
    --caption-font: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  }

  .image-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    border-radius: var(--border-radius);
    overflow: hidden; /* オーバーフローを防止 */
    max-width: 40%;
    margin: 20px auto;
  }

  .image-card:hover {
    box-shadow: var(--hover-shadow);
    transform: translateY(-5px);
  }

  .image-container {
    height:60%; /* 画像の最大高さを設定 */
    max-width: 100%;
    overflow: hidden; /* オーバーフローを防止 */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    transition: transform var(--transition-speed);
  }

  /* レスポンシブデザイン */
  @media (max-width: 768px) {
    .image-card {
      margin: 15px;
    }

    figcaption {
      font-size: 0.9em;
      padding: 12px;
    }
  }

  @media (max-width: 480px) {
    .image-card {
      margin: 10px;
    }

    figcaption {
      font-size: 0.85em;
      padding: 10px;
    }
  }
</style>